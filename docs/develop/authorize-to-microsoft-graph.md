---
title: Autorizar para o Microsoft Graph no seu Suplemento do Office
description: ''
ms.date: 04/10/2018
ms.openlocfilehash: 83a9dd0beda9cb17a4f404c32cbe08a1e07f277e
ms.sourcegitcommit: 30435939ab8b8504c3dbfc62fd29ec6b0f1a7d22
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/12/2018
ms.locfileid: "23944296"
---
# <a name="authorize-to-microsoft-graph-in-your-office-add-in-preview"></a><span data-ttu-id="112c9-102">Autorizar para o Microsoft Graph no seu Suplemento do Office (visualização)</span><span class="sxs-lookup"><span data-stu-id="112c9-102">Authorize to Microsoft Graph in your Office Add-in (preview)</span></span>

<span data-ttu-id="112c9-p101">Os usuários entram no Office (nas plataformas online, celular e área de trabalho) usando uma conta pessoal da Microsoft ou uma conta de corporativa ou de estudante (Office 365). A melhor forma para um suplemento do Office obter acesso autorizado ao [Microsoft Graph](https://developer.microsoft.com/graph/docs) é usar as credenciais de logon do usuário no Office. Isso permite que eles acessem seus dados do Microsoft Graph sem precisar entrar uma segunda vez.</span><span class="sxs-lookup"><span data-stu-id="112c9-p101">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their work or school (Office 365) account. The best way for an Office add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on. This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span> 

> [!NOTE]
> <span data-ttu-id="112c9-106">Atualmente a API de logon único tem suporte em versão prévia para Word, Excel e PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="112c9-106">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="112c9-107">Confira mais informações sobre os programas para os quais a API de logon único tem suporte no momento em [Conjuntos de requisitos da IdentityAPI](https://docs.microsoft.com/javascript/office/requirement-sets/identity-api-requirement-sets?view=office-js).</span><span class="sxs-lookup"><span data-stu-id="112c9-107">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](https://docs.microsoft.com/javascript/office/requirement-sets/identity-api-requirement-sets?view=office-js).</span></span>
> <span data-ttu-id="112c9-108">Se você estiver trabalhando com um suplemento do Outlook, certifique-se de habilitar a Autenticação Moderna para a locação do Office 365.</span><span class="sxs-lookup"><span data-stu-id="112c9-108">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="112c9-109">Confira mais informações sobre como fazer isso em [Exchange Online: como habilitar seu locatário para autenticação moderna](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="112c9-109">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="112c9-110">Arquitetura do suplemento para SSO e Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="112c9-110">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="112c9-111">Além de hospedar as páginas e o JavaScript do aplicativo web, o suplemento também deve hospedar, ao mesmo tempo o [nome de domínio totalmente qualificado](https://docs.microsoft.com/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), uma ou mais APIs web que obterá um token de acesso ao Microsoft Graph e fará solicitações a ele.</span><span class="sxs-lookup"><span data-stu-id="112c9-111">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](https://docs.microsoft.com/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="112c9-112">O manifesto do suplemento contém a marcação que especifica como ele está registrado no ponto de extremidade v2.0 do Azure Active Directory (Azure AD) e especifica todas as permissões para o Microsoft Graph que o suplemento precisa.</span><span class="sxs-lookup"><span data-stu-id="112c9-112">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="112c9-113">Como ele funciona em tempo de execução</span><span class="sxs-lookup"><span data-stu-id="112c9-113">How it works at runtime</span></span>

<span data-ttu-id="112c9-114">O diagrama a seguir mostra como o processo de entrada e acesso ao Microsoft Graph funciona.</span><span class="sxs-lookup"><span data-stu-id="112c9-114">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![Diagrama que mostra o processo de SSO](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="112c9-p103">No suplemento, o JavaScript chama a nova API Office.js [ getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) . Isso informa ao aplicativo host do Office para obter um token de acesso ao suplemento. (A partir de agora, ele será chamado de \*\* token de acesso de inicialização\*\*  porque será substituído por um segundo token mais tarde no processo. Para um exemplo de token de acesso de inicialização decodificado, confira [  Exemplo de token de acesso](sso-in-office-add-ins.md#example-access-token) .)</span><span class="sxs-lookup"><span data-stu-id="112c9-p103">In the add-in, JavaScript calls a new Office.js API [](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference). This tells the Office host application to obtain an access token to the add-in. (Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process. For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
1. <span data-ttu-id="112c9-120">Se o usuário não estiver conectado, o aplicativo host do Office abrirá uma janela pop-up para o usuário entrar.</span><span class="sxs-lookup"><span data-stu-id="112c9-120">If the user is not signed in, the Office host application opens a pop-up window for the user to sign in.</span></span>
1. <span data-ttu-id="112c9-121">Se essa for a primeira vez que o usuário atual usa seu suplemento, será solicitado que ele dê o consentimento.</span><span class="sxs-lookup"><span data-stu-id="112c9-121">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
1. <span data-ttu-id="112c9-122">O aplicativo host do Office solicita o **token de acesso de inicialização** do ponto de extremidade do Azure AD v2.0 para o usuário atual.</span><span class="sxs-lookup"><span data-stu-id="112c9-122">The Office host application requests the **add-in token** from the Azure AD v2.0 endpoint for the current user.</span></span>
1. <span data-ttu-id="112c9-123">O Azure AD envia o token de inicialização ao aplicativo host do Office.</span><span class="sxs-lookup"><span data-stu-id="112c9-123">Azure AD sends the add-in token to the Office host application.</span></span>
1. <span data-ttu-id="112c9-124">O aplicativo host do Office envia o **token de acesso de inicialização** ao suplemento como parte do objeto de resultado que retornou pela chamada de `getAccessTokenAsync`.</span><span class="sxs-lookup"><span data-stu-id="112c9-124">The Office host application sends the **add-in token** to the add-in as part of the result object returned by the `getAccessTokenAsync` call.</span></span>
1. <span data-ttu-id="112c9-125">O JavaScript no suplemento faz uma solicitação HTTP a uma API da Web que está hospedada no mesmo domínio totalmente qualificado que o suplemento e inclui o **token de acesso de inicialização** como prova de autorização.</span><span class="sxs-lookup"><span data-stu-id="112c9-125">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **add-in token** as authorization proof.</span></span>  
1. <span data-ttu-id="112c9-126">O código do servidor valida o **token de acesso de inicialização** de entrada.</span><span class="sxs-lookup"><span data-stu-id="112c9-126">Server-side code validates the incoming **add-in token**.</span></span>
1. <span data-ttu-id="112c9-127">O código do servidor usa o fluxo “em nome de” (definido em [Troca de Token do OAuth2](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) e o [daemon ou aplicativo para servidores para o cenário da API da Web do Azure](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-scenarios#daemon-or-server-application-to-web-api)) para obter um token de acesso para o Microsoft Graph em troca do token de acesso de inicialização.</span><span class="sxs-lookup"><span data-stu-id="112c9-127">Server-side code uses the “on behalf of” flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](https://docs.microsoft.com/azure/active-directory/develop/active-directory-authentication-scenarios#daemon-or-server-application-to-web-api)) to obtain an access token for Microsoft Graph (hereafter, the "MSG token") in exchange for the add-in token.</span></span>
1. <span data-ttu-id="112c9-128">O Azure AD retorna o token de acesso ao Microsoft Graph (e um token de atualização, se o suplemento solicitar a permissão *offline_access*) para o suplemento.</span><span class="sxs-lookup"><span data-stu-id="112c9-128">Azure AD returns the MSG token (and a refresh token, if the add-in requests offline_access permission) to the add-in.</span></span>
1. <span data-ttu-id="112c9-129">O código do servidor armazena em cache o token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="112c9-129">Server-side code caches the access token to Microsoft Graph.</span></span>
1. <span data-ttu-id="112c9-130">O código do lado do servidor faz solicitações ao Microsoft Graph e inclui o token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="112c9-130">Server-side code makes requests to Microsoft Graph and includes the MSG token.</span></span>
1. <span data-ttu-id="112c9-131">O Microsoft Graph retorna os dados para o suplemento, que pode transmiti-los à interface do usuário do suplemento.</span><span class="sxs-lookup"><span data-stu-id="112c9-131">Microsoft Graph returns data to the add-in, which can pass it on to the add-in’s UI.</span></span>
1. <span data-ttu-id="112c9-132">Quando o token de acesso ao Microsoft Graph expira, o código do servidor pode usar seu token de atualização para obter um novo token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="112c9-132">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="112c9-133">Desenvolver um suplemento SSO que acesse o Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="112c9-133">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="112c9-134">Você desenvolve um suplemento que acessa o Microsoft Graph como faria com qualquer outro suplemento que usa SSO.</span><span class="sxs-lookup"><span data-stu-id="112c9-134">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO.</span></span> <span data-ttu-id="112c9-135">Para uma descrição detalhada, veja [Ativar logon único para Suplementos do Office](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins). A diferença é que é obrigatório que o suplemento tenha uma API da Web do servidor e o que é chamado de token de acesso nesse artigo é chamado de "token de acesso de inicialização".</span><span class="sxs-lookup"><span data-stu-id="112c9-135">For a thorough description, see [Enable single sign-on for Office Add-ins](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span> 

<span data-ttu-id="112c9-136">Dependendo do seu idioma e estrutura, podem existir bibliotecas disponíveis para simplificar o código do lado do servidor que você precisar escrever.</span><span class="sxs-lookup"><span data-stu-id="112c9-136">Depending on your language and framework, libraries might be available that will simplify the code you have to write.</span></span> <span data-ttu-id="112c9-137">Seu código deve fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="112c9-137">Your server-side code should do the following:</span></span>

* <span data-ttu-id="112c9-138">Validar o token de acesso de inicialização do suplemento recebido do manipulador de token que você criou.</span><span class="sxs-lookup"><span data-stu-id="112c9-138">Validate the add-in token that is received from the token handler you created earlier.</span></span> <span data-ttu-id="112c9-139">Para mais informações, veja [Validar o token de acesso](sso-in-office-add-ins.md#validate-the-access-token).</span><span class="sxs-lookup"><span data-stu-id="112c9-139">For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="112c9-140">Iniciar o fluxo "em nome de" com uma chamada para o ponto de extremidade v2.0 do Azure AD que inclui o token de acesso de inicialização, alguns metadados sobre o usuário e as credenciais do suplemento (seu ID e segredo).</span><span class="sxs-lookup"><span data-stu-id="112c9-140">Initiate the “on behalf of” flow with a call to the Azure AD v2.0 endpoint that includes the add-in access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="112c9-141">Armazenar em cache o token de acesso ao Microsoft Graph que foi retornado.</span><span class="sxs-lookup"><span data-stu-id="112c9-141">Use the access token to call Microsoft Graph.</span></span> <span data-ttu-id="112c9-142">Para mais informações sobre esse fluxo, veja [Fluxo em nome de do Active Directory do Azure v2.0 e OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="112c9-142">For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>
* <span data-ttu-id="112c9-143">Criar um ou mais métodos de API da Web que obtenham dados do Microsoft Graph passando o token de acesso em cache para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="112c9-143">Create one or more Web API methods that get Microsoft Graph data by passing the cached access token to Microsoft Graph.</span></span>

> [!NOTE]
> <span data-ttu-id="112c9-144">Para ver exemplos de tokens de acesso decodificados para o Microsoft Graph e obtidos pelo fluxo "em nome de", veja [Fluxo em nome de do Active Directory do Azure v2.0 e OAuth 2.0](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="112c9-144">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](https://docs.microsoft.com/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="112c9-145">Confira exemplos de passo a passo e cenários detalhados em:</span><span class="sxs-lookup"><span data-stu-id="112c9-145">For examples of detailed walkthroughs, see:</span></span>

* [<span data-ttu-id="112c9-146">Criar um Suplemento do Office com Node.js que usa logon único</span><span class="sxs-lookup"><span data-stu-id="112c9-146">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="112c9-147">Criar um Suplemento do Office com ASP.NET que usa logon único</span><span class="sxs-lookup"><span data-stu-id="112c9-147">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="112c9-148">Cenário: implementar o logon único no serviço em um suplemento do Outlook</span><span class="sxs-lookup"><span data-stu-id="112c9-148">Scenario: Implement single sign-on to your service in an Outlook Add-in</span></span>](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in)



