---
title: Autorizar para o Microsoft Graph no seu Suplemento do Office
description: ''
ms.date: 04/10/2018
ms.openlocfilehash: 495aa5554550d10711c418339d412e3a312d02fb
ms.sourcegitcommit: c72c35e8389c47a795afbac1b2bcf98c8e216d82
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/23/2018
---
# <a name="authorize-to-microsoft-graph-in-your-office-add-in-preview"></a><span data-ttu-id="bda40-102">Autorizar para o Microsoft Graph no seu Suplemento do Office (visualiza??o)</span><span class="sxs-lookup"><span data-stu-id="bda40-102">Authorize to Microsoft Graph in your Office Add-in (preview)</span></span>

<span data-ttu-id="bda40-103">Os usu?rios entram no Office (online, em dispositivos m?veis e plataformas desktop) usando tanto a conta pessoal deles da Microsoft, como a conta corporativa ou de estudante (Office 365).</span><span class="sxs-lookup"><span data-stu-id="bda40-103">Users sign in to Office (online, mobile, and desktop platforms) using either their personal Microsoft account or their work or school (Office 365) account.</span></span> <span data-ttu-id="bda40-104">A melhor maneira de um Suplemento do Office ter acesso autorizado ao [Microsoft Graph](https://developer.microsoft.com/graph/docs) ? usar as credenciais de entrada do usu?rio no Office.</span><span class="sxs-lookup"><span data-stu-id="bda40-104">The best way for an Office add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on.</span></span> <span data-ttu-id="bda40-105">Isso permite acessar os dados do Microsoft Graph sem precisar entrar uma segunda vez.</span><span class="sxs-lookup"><span data-stu-id="bda40-105">This enables them to access their Microsoft Graph data without needing to sign in a second time.</span></span> 

> [!NOTE]
> <span data-ttu-id="bda40-106">Atualmente, a API de logon ?nico tem suporte para Word, Excel e PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="bda40-106">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="bda40-107">Confira mais informa??es sobre os programas para os quais a API de logon ?nico tem suporte no momento em [Conjuntos de requisitos da IdentityAPI](https://dev.office.com/reference/add-ins/requirement-sets/identity-api-requirement-sets).</span><span class="sxs-lookup"><span data-stu-id="bda40-107">For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets](https://dev.office.com/reference/add-ins/requirement-sets/identity-api-requirement-sets).</span></span>
> <span data-ttu-id="bda40-108">Se voc? estiver trabalhando com um suplemento do Outlook, certifique-se de habilitar a Autentica??o Moderna para a loca??o do Office 365.</span><span class="sxs-lookup"><span data-stu-id="bda40-108">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="bda40-109">Confira mais informa??es sobre como fazer isso em [Exchange Online: como habilitar seu locat?rio para autentica??o moderna](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="bda40-109">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="add-in-architecture-for-sso-and-microsoft-graph"></a><span data-ttu-id="bda40-110">Arquitetura do suplemento para SSO e Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="bda40-110">Add-in architecture for SSO and Microsoft Graph</span></span>

<span data-ttu-id="bda40-111">Al?m de hospedar as p?ginas e o JavaScript do aplicativo web, o suplemento tamb?m deve hospedar, ao mesmo tempo o [nome de dom?nio totalmente qualificado](https://msdn.microsoft.com/en-us/library/windows/desktop/ms682135.aspx#_dns_fully_qualified_domain_name_fqdn__gly), uma ou mais APIs web que obter? um token de acesso ao Microsoft Graph e far? solicita??es a ele.</span><span class="sxs-lookup"><span data-stu-id="bda40-111">In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name](https://msdn.microsoft.com/en-us/library/windows/desktop/ms682135.aspx#_dns_fully_qualified_domain_name_fqdn__gly), one or more web APIs that will get an access token to Microsoft Graph and make requests to it.</span></span>

<span data-ttu-id="bda40-112">O manifesto do suplemento cont?m a marca??o que especifica como ele est? registrado no ponto de extremidade v2.0 do Azure Active Directory (Azure AD) e especifica todas as permiss?es para o Microsoft Graph que o suplemento precisa.</span><span class="sxs-lookup"><span data-stu-id="bda40-112">The add-in manifest contains markup that specifies how the add-in is registered in the Azure Active Directory (Azure AD) v2.0 endpoint, and it specifies any permissions to Microsoft Graph that the add-in needs.</span></span>

### <a name="how-it-works-at-runtime"></a><span data-ttu-id="bda40-113">Como ele funciona em tempo de execu??o</span><span class="sxs-lookup"><span data-stu-id="bda40-113">How it works at runtime</span></span>

<span data-ttu-id="bda40-114">O diagrama a seguir mostra como o processo de entrada e acesso ao Microsoft Graph funciona.</span><span class="sxs-lookup"><span data-stu-id="bda40-114">The following diagram shows how the process of signing in and getting access to Microsoft Graph works.</span></span>

![Diagrama que mostra o processo de SSO](../images/sso-access-to-microsoft-graph.png)

1. <span data-ttu-id="bda40-116">No suplemento, o JavaScript chama uma nova API Office.js `getAccessTokenAsync`.</span><span class="sxs-lookup"><span data-stu-id="bda40-116">In the add-in, JavaScript calls a new Office.js API `getAccessTokenAsync`.</span></span> <span data-ttu-id="bda40-117">Isso notifica o aplicativo host do Office para que obtenha um token de acesso para o suplemento.</span><span class="sxs-lookup"><span data-stu-id="bda40-117">This tells the Office host application to obtain an access token to the add-in.</span></span> <span data-ttu-id="bda40-118">(Daqui por diante, ele ser? chamado de **token de acesso de inicializa??o** porque ser? substitu?do por um segundo token no processo posteriormente.</span><span class="sxs-lookup"><span data-stu-id="bda40-118">(Hereafter, this is called the **bootstrap access token** because it is replaced with a second token later in the process.</span></span> <span data-ttu-id="bda40-119">Para ver um exemplo de token de acesso de inicializa??o decodificado, veja [Exemplo de token de acesso](sso-in-office-add-ins.md#example-access-token).)</span><span class="sxs-lookup"><span data-stu-id="bda40-119">For an example of a decoded bootstrap access token, see [Example access token](sso-in-office-add-ins.md#example-access-token).)</span></span>
1. <span data-ttu-id="bda40-120">Se o usu?rio n?o estiver conectado, o aplicativo host do Office abrir? uma janela pop-up para o usu?rio entrar.</span><span class="sxs-lookup"><span data-stu-id="bda40-120">If the user is not signed in, the Office host application opens a pop-up window for the user to sign in.</span></span>
1. <span data-ttu-id="bda40-121">Se essa ? a primeira vez que o usu?rio atual usa seu suplemento, ser? solicitado que ele d? o consentimento.</span><span class="sxs-lookup"><span data-stu-id="bda40-121">If this is the first time the current user has used your add-in, he or she is prompted to consent.</span></span>
1. <span data-ttu-id="bda40-122">O aplicativo host do Office solicita o **token de acesso de inicializa??o** do ponto de extremidade v2.0 do Azure AD para o usu?rio atual.</span><span class="sxs-lookup"><span data-stu-id="bda40-122">The Office host application requests the **add-in token** from the Azure AD v2.0 endpoint for the current user.</span></span>
1. <span data-ttu-id="bda40-123">O Azure AD envia o token de inicializa??o ao aplicativo host do Office.</span><span class="sxs-lookup"><span data-stu-id="bda40-123">Azure AD sends the add-in token to the Office host application.</span></span>
1. <span data-ttu-id="bda40-124">O aplicativo host do Office envia o **token de acesso de inicializa??o** ao suplemento como parte do objeto de resultado que retornou pela chamada de `getAccessTokenAsync`.</span><span class="sxs-lookup"><span data-stu-id="bda40-124">The Office host application sends the **add-in token** to the add-in as part of the result object returned by the `getAccessTokenAsync` call.</span></span>
1. <span data-ttu-id="bda40-125">O JavaScript no suplemento faz uma solicita??o HTTP a uma API da Web que est? hospedada no mesmo dom?nio totalmente qualificado que o suplemento e inclui o **token de acesso de inicializa??o** como prova de autoriza??o.</span><span class="sxs-lookup"><span data-stu-id="bda40-125">JavaScript in the add-in makes an HTTP request to a web API that is hosted at the same fully-qualified domain as the add-in, and it includes the **add-in token** as authorization proof.</span></span>  
1. <span data-ttu-id="bda40-126">O c?digo do servidor valida o **token de acesso de inicializa??o** de entrada.</span><span class="sxs-lookup"><span data-stu-id="bda40-126">Server-side code validates the incoming **add-in token**.</span></span>
1. <span data-ttu-id="bda40-127">O c?digo do servidor usa o fluxo ?em nome de? (definido em [Troca de Token do OAuth2](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) e o [daemon ou aplicativo para servidores para o cen?rio da API da Web do Azure](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-authentication-scenarios#daemon-or-server-application-to-web-api)) para obter um token de acesso para o Microsoft Graph em troca do token de acesso de inicializa??o.</span><span class="sxs-lookup"><span data-stu-id="bda40-127">Server-side code uses the ?on behalf of? flow (defined at [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02) and the [daemon or server application to web API Azure scenario](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-authentication-scenarios#daemon-or-server-application-to-web-api)) to obtain an access token for Microsoft Graph (hereafter, the "MSG token") in exchange for the add-in token.</span></span>
1. <span data-ttu-id="bda40-128">O Azure AD retorna o token de acesso ao Microsoft Graph para o suplemento (e um token de atualiza??o, se o suplemento solicitar a permiss?o *offline_access*).</span><span class="sxs-lookup"><span data-stu-id="bda40-128">Azure AD returns the MSG token (and a refresh token, if the add-in requests offline_access permission) to the add-in.</span></span>
1. <span data-ttu-id="bda40-129">O c?digo do servidor armazena em cache o token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="bda40-129">Server-side code caches the access token to Microsoft Graph.</span></span>
1. <span data-ttu-id="bda40-130">O c?digo do servidor faz solicita??es para o Microsoft Graph e inclui o token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="bda40-130">Server-side code makes requests to Microsoft Graph and includes the MSG token.</span></span>
1. <span data-ttu-id="bda40-131">O Microsoft Graph retorna os dados para o suplemento, que pode transmiti-los ? interface do usu?rio do suplemento.</span><span class="sxs-lookup"><span data-stu-id="bda40-131">Microsoft Graph returns data to the add-in, which can pass it on to the add-in?s UI.</span></span>
1. <span data-ttu-id="bda40-132">Quando o token de acesso ao Microsoft Graph expira, o c?digo do servidor pode usar seu token de atualiza??o para obter um novo token de acesso ao Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="bda40-132">When the access token to Microsoft Graph expires, the server-side code can use its refresh token to get a new access token to Microsoft Graph.</span></span>

## <a name="develop-an-sso-add-in-that-accesses-microsoft-graph"></a><span data-ttu-id="bda40-133">Desenvolver um suplemento SSO que acesse o Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="bda40-133">Develop an SSO add-in that accesses Microsoft Graph</span></span>

<span data-ttu-id="bda40-134">Voc? desenvolve um suplemento que acessa o Microsoft Graph como faria com qualquer outro suplemento que usa SSO.</span><span class="sxs-lookup"><span data-stu-id="bda40-134">You develop an add-in that accesses Microsoft Graph just as you would any other add-in that uses SSO.</span></span> <span data-ttu-id="bda40-135">Para uma descri??o detalhada, veja [Ativar logon ?nico para Suplementos do Office](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/sso-in-office-add-ins). A diferen?a ? que ? obrigat?rio que o suplemento tenha uma API da Web do servidor e o que ? chamado de token de acesso nesse artigo ? chamado de "token de acesso de inicializa??o".</span><span class="sxs-lookup"><span data-stu-id="bda40-135">For a thorough description, see [Enable single sign-on for Office Add-ins](https://docs.microsoft.com/en-us/office/dev/add-ins/develop/sso-in-office-add-ins). The difference is that it is mandatory that the add-in have a server-side Web API, and what's called the access token in that article is called the "bootstrap access token."</span></span> 

<span data-ttu-id="bda40-136">Dependendo do seu idioma e estrutura, bibliotecas podem estar dispon?veis para simplificar o c?digo do servidor que voc? precisa escrever.</span><span class="sxs-lookup"><span data-stu-id="bda40-136">Depending on your language and framework, libraries might be available that will simplify the code you have to write.</span></span> <span data-ttu-id="bda40-137">Seu c?digo deve fazer o seguinte:</span><span class="sxs-lookup"><span data-stu-id="bda40-137">Your server-side code should do the following:</span></span>

* <span data-ttu-id="bda40-138">Validar o token de acesso de inicializa??o do suplemento recebido do manipulador de token criado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="bda40-138">Validate the add-in token that is received from the token handler you created earlier.</span></span> <span data-ttu-id="bda40-139">Para mais informa??es, veja [Validar o token de acesso](sso-in-office-add-ins.md#validate-the-access-token).</span><span class="sxs-lookup"><span data-stu-id="bda40-139">For more information, see [Validate the access token](sso-in-office-add-ins.md#validate-the-access-token).</span></span> 
* <span data-ttu-id="bda40-140">Iniciar o fluxo "em nome de" com uma chamada para o ponto de extremidade v2.0 do Azure AD que inclui o token de acesso de inicializa??o, alguns metadados sobre o usu?rio e as credenciais do suplemento (sua ID e segredo).</span><span class="sxs-lookup"><span data-stu-id="bda40-140">Initiate the ?on behalf of? flow with a call to the Azure AD v2.0 endpoint that includes the add-in access token, some metadata about the user, and the credentials of the add-in (its ID and secret).</span></span>
* <span data-ttu-id="bda40-141">Armazenar em cache o token de acesso retornado para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="bda40-141">Use the access token to call Microsoft Graph.</span></span> <span data-ttu-id="bda40-142">Para mais informa??es sobre esse fluxo, veja [Fluxo em nome de do Active Directory do Azure v2.0 e OAuth 2.0](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="bda40-142">For more information about this flow see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>
* <span data-ttu-id="bda40-143">Criar um ou mais m?todos de API da Web que obtenham dados do Microsoft Graph passando o token de acesso em cache para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="bda40-143">Create one or more Web API methods that get Microsoft Graph data by passing the cached access token to Microsoft Graph.</span></span>

> [!NOTE]
> <span data-ttu-id="bda40-144">Para ver exemplos de tokens de acesso decodificados para o Microsoft Graph e obtidos pelo fluxo "em nome de", veja [Fluxo em nome de do Active Directory do Azure v2.0 e OAuth 2.0](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span><span class="sxs-lookup"><span data-stu-id="bda40-144">For examples of decoded access tokens for Microsoft Graph that have been obtained by the "on-behalf-of" flow, see [Azure Active Directory v2.0 and OAuth 2.0 On-Behalf-Of flow](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of).</span></span>

<span data-ttu-id="bda40-145">Confira exemplos de explica??es e cen?rios detalhados em:</span><span class="sxs-lookup"><span data-stu-id="bda40-145">For examples of detailed walkthroughs, see:</span></span>

* [<span data-ttu-id="bda40-146">Criar um Suplemento do Office com Node.js que usa logon ?nico</span><span class="sxs-lookup"><span data-stu-id="bda40-146">Create a Node.js Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-nodejs.md)
* [<span data-ttu-id="bda40-147">Criar um Suplemento do Office com ASP.NET que usa logon ?nico</span><span class="sxs-lookup"><span data-stu-id="bda40-147">Create an ASP.NET Office Add-in that uses single sign-on</span></span>](create-sso-office-add-ins-aspnet.md)
* [<span data-ttu-id="bda40-148">Cen?rio: implementar o logon ?nico no servi?o em um suplemento do Outlook</span><span class="sxs-lookup"><span data-stu-id="bda40-148">Scenario: Implement single sign-on to your service in an Outlook add-in</span></span>](https://docs.microsoft.com/en-us/outlook/add-ins/implement-sso-in-outlook-add-in)



