---
title: Solucionar problemas de mensagens de erro no logon único (SSO)
description: ''
ms.date: 12/08/2017
ms.openlocfilehash: 5abf10d8281ea54be9a172c3f45b742fb33991df
ms.sourcegitcommit: c53f05bbd4abdfe1ee2e42fdd4f82b318b363ad7
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 10/12/2018
ms.locfileid: "25506067"
---
# <a name="troubleshoot-error-messages-for-single-sign-on-sso-preview"></a><span data-ttu-id="ebda6-102">Solucionar problemas de mensagens de erro no logon único (SSO) (versão prévia)</span><span class="sxs-lookup"><span data-stu-id="ebda6-102">Troubleshoot error messages for single sign-on (SSO) (preview)</span></span>

<span data-ttu-id="ebda6-103">Este artigo fornece algumas orientações sobre como solucionar problemas com o logon único (SSO) nos suplementos do Office e como fazer com que seu suplemento habilitado para SSO trate de forma robusta os erros ou condições especiais.</span><span class="sxs-lookup"><span data-stu-id="ebda6-103">This article provides some guidance about how to troubleshoot problems with single sign-on (SSO) in Office Add-ins, and how to make your SSO-enabled add-in robustly handle special conditions or errors.</span></span>

> [!NOTE]
> <span data-ttu-id="ebda6-p101">|||UNTRANSLATED_CONTENT_START|||The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint. For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets]https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets). To use SSO, you must load the beta version of the Office JavaScript Library from https://appsforoffice.microsoft.com/lib/beta/hosted/office.js in the startup HTML page of the add-in. If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy. For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).|||UNTRANSLATED_CONTENT_END|||</span><span class="sxs-lookup"><span data-stu-id="ebda6-p101">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint. For more information about where the Single Sign-on API is currently supported, see [IdentityAPI requirement sets]https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets). To use SSO, you must load the beta version of the Office JavaScript Library from https://appsforoffice.microsoft.com/lib/beta/hosted/office.js in the startup HTML page of the add-in. If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy. For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="debugging-tools"></a><span data-ttu-id="ebda6-109">Ferramentas de depuração</span><span class="sxs-lookup"><span data-stu-id="ebda6-109">Debugging tools</span></span>

<span data-ttu-id="ebda6-p102">Quando estiver desenvolvendo, é altamente recomendável que use uma ferramenta que possa interceptar e exibir as solicitações e respostas HTTP do serviço web do seu suplemento. Duas das mais populares são:</span><span class="sxs-lookup"><span data-stu-id="ebda6-p102">We strongly recommend that you use a tool that can intercept and display the HTTP Requests from, and Responses to, your add-in's web service when you are developing. Two of the most popular are:</span></span> 

- <span data-ttu-id="ebda6-112">[Fiddler](http://www.telerik.com/fiddler): Gratuita ([Documentação](http://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span><span class="sxs-lookup"><span data-stu-id="ebda6-112">[Fiddler](http://www.telerik.com/fiddler): Free ([Documentation](http://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span></span>
- <span data-ttu-id="ebda6-p103">[Charles](https://www.charlesproxy.com/): Gratuita por 30 dias. ([Documentação](https://www.charlesproxy.com/documentation/))</span><span class="sxs-lookup"><span data-stu-id="ebda6-p103">[Charles](https://www.charlesproxy.com/): Free for 30 days. ([Documenation](https://www.charlesproxy.com/documentation/))</span></span>

<span data-ttu-id="ebda6-115">Ao desenvolver sua API de serviço, também pode tentar:</span><span class="sxs-lookup"><span data-stu-id="ebda6-115">When developing your service API, you may also want to try:</span></span>

- <span data-ttu-id="ebda6-116">[Postman](http://www.getpostman.com/postman): Gratuita ([Documentação](https://www.getpostman.com/docs/))</span><span class="sxs-lookup"><span data-stu-id="ebda6-116">[Postman](http://www.getpostman.com/postman): Free ([Documentation](https://www.getpostman.com/docs/))</span></span>

## <a name="causes-and-handling-of-errors-from-getaccesstokenasync"></a><span data-ttu-id="ebda6-117">Causas e tratamento dos erros do getAccessTokenAsync</span><span class="sxs-lookup"><span data-stu-id="ebda6-117">Causes and handling of errors from getAccessTokenAsync</span></span>

<span data-ttu-id="ebda6-118">Para acessar exemplos de manipulação dos erros descritos nesta seção, confira:</span><span class="sxs-lookup"><span data-stu-id="ebda6-118">For examples of the error handling described in this section, see:</span></span>
- [<span data-ttu-id="ebda6-119">Home.js em Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="ebda6-119">Home.js in Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/Home.js)
- [<span data-ttu-id="ebda6-120">program.js em Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="ebda6-120">program.js in Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/public/program.js)

> [!NOTE]
> <span data-ttu-id="ebda6-p104">Além das sugestões feitas nesta seção, um suplemento do Outlook tem uma outra maneira de responder a qualquer erro 13*nnn* . Para obter detalhes, consulte [cenário: implementar o logon único para seu serviço em um suplemento do Outlook](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in) e [o suplemento de amostra de AttachmentsDemo](https://github.com/OfficeDev/outlook-add-in-attachments-demo).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p104">Besides the suggestions made in this section, an Outlook add-in has an additional way to respond to any 13*nnn* error. For details, see [Scenario: Implement single sign-on to your service in an Outlook add-in](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in) and [AttachmentsDemo Sample Add-in](https://github.com/OfficeDev/outlook-add-in-attachments-demo).</span></span> 

### <a name="13000"></a><span data-ttu-id="ebda6-123">13000</span><span class="sxs-lookup"><span data-stu-id="ebda6-123">13000</span></span>

<span data-ttu-id="ebda6-124">A API [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) não é suportada pelo suplemento ou pela versão do Office.</span><span class="sxs-lookup"><span data-stu-id="ebda6-124">The [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) API is not supported by the add-in or the Office version.</span></span> 

- <span data-ttu-id="ebda6-p105">A versão do Office não suporta SSO. A versão necessária é o Office 2016, versão 1710, compilação 8629.nnnn ou posterior (a versão de assinatura do Office 365, às vezes chamada de "Clique para Executar"). É possível que precise participar do programa Office Insider para obter essa versão. Para saber mais, confira a página [Seja um Office Insider](https://products.office.com/office-insider?tab=tab-1).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p105">The version of Office does not support SSO. The required version is Office 2016, Version 1710, build 8629.nnnn or later (the Office 365 subscription version, sometimes called “Click to Run”). You might need to be an Office Insider to get this version. For more information, see [Be an Office Insider](https://products.office.com/office-insider?tab=tab-1).</span></span> 
- <span data-ttu-id="ebda6-129">No manifesto do suplemento está faltando a seção [WebApplicationInfo](https://docs.microsoft.com/office/dev/add-ins/reference/manifest/webapplicationinfo?view=office-js) apropriada.</span><span class="sxs-lookup"><span data-stu-id="ebda6-129">The add-in manifest is missing the proper [WebApplicationInfo](https://docs.microsoft.com/office/dev/add-ins/reference/manifest/webapplicationinfo?view=office-js) section.</span></span>

<span data-ttu-id="ebda6-p106">Seu suplemento deve responder a esse erro voltando para um sistema alternativo de autenticação do usuário. Para obter mais informações, consulte [requisitos e práticas recomendadas](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p106">Your add-in should respond to this error by falling back to an alternate system of user authentication. For more information, see [Requirements and Best Practices](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span></span>

### <a name="13001"></a><span data-ttu-id="ebda6-132">13001</span><span class="sxs-lookup"><span data-stu-id="ebda6-132">13001</span></span>

<span data-ttu-id="ebda6-p107">O usuário não tiver entrado no Office. Seu código deve se lembrar de `getAccessTokenAsync` método e passar a opção `forceAddAccount: true` no parâmetro [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) . Mas não fazer isso mais de uma vez. O usuário pode ter decidido não entrar.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p107">The user is not signed into Office. Your code should recall the `getAccessTokenAsync` method and pass the option `forceAddAccount: true` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter. But don't do this more than once. The user may have decided not to sign-in.</span></span>

<span data-ttu-id="ebda6-p108">Este erro nunca é visto no Office Online. Se o cookie do usuário expirar, o Office Online retornará o erro 13006.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p108">This error is never seen in Office Online. If the user's cookie expires, Office Online returns error 13006.</span></span> 

### <a name="13002"></a><span data-ttu-id="ebda6-139">13002</span><span class="sxs-lookup"><span data-stu-id="ebda6-139">13002</span></span>

<span data-ttu-id="ebda6-140">O usuário cancelou a sessão ou consentiu; por exemplo, escolhendo **Cancelar** no diálogo de consentimento.</span><span class="sxs-lookup"><span data-stu-id="ebda6-140">The user aborted sign in or consent; for example, by choosing **Cancel** on the consent dialog.</span></span> 

- <span data-ttu-id="ebda6-141">Se o suplemento fornece funções que não exigem que o usuário esteja conectado (ou que tenha concedido consentimento), seu código deve capturar esse erro e permitir que o suplemento permaneça em execução.</span><span class="sxs-lookup"><span data-stu-id="ebda6-141">If your add-in provides functions that don't require the user to be signed in (or to have granted consent), then your code should catch this error and allow the add-in to stay running.</span></span>
- <span data-ttu-id="ebda6-142">Se o suplemento exige um usuário conectado que concedeu consentimento, seu código deverá solicitar ao usuário que repita a operação, mas não mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="ebda6-142">If the add-in requires a signed-in user who has granted consent, your code should ask the user to repeat the operation, but not more than once.</span></span> 

### <a name="13003"></a><span data-ttu-id="ebda6-143">13003</span><span class="sxs-lookup"><span data-stu-id="ebda6-143">13003</span></span>

<span data-ttu-id="ebda6-p109">Tipo de usuário sem suporte. O usuário não está conectado no Office com uma conta do Office 365 ("trabalho ou escola") ou de Account válido da Microsoft. Isso pode acontecer se o Office for executado com uma conta de domínio local, por exemplo. Seu código seja pergunte ao usuário entrar no Office ou reverterá para um sistema alternativo de autenticação do usuário. Para obter mais informações, consulte [requisitos e práticas recomendadas](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p109">User Type not supported. The user isn't signed into Office with a valid Microsoft Account or Office 365 ("Work or School") account. This may happen if Office runs with an on-premises domain account, for example. Your code should either ask the user to sign in to Office or fall back to an alternate system of user authentication. For more information, see [Requirements and Best Practices](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span></span>


### <a name="13004"></a><span data-ttu-id="ebda6-149">13004</span><span class="sxs-lookup"><span data-stu-id="ebda6-149">13004</span></span>

<span data-ttu-id="ebda6-p110">Inválidos do recurso. O manifesto do suplemento ainda não foi configurado corretamente. Atualize o manifesto. Para obter mais informações, consulte [Validar e solucionar problemas com seu manifesto](../testing/troubleshoot-manifest.md). O máximo de comuns problema é que o elemento de **recurso** (no elemento **WebApplicationInfo** ) tem um domínio que não corresponde ao domínio do add-in. Embora a parte do protocolo do valor de recurso deve ser "api" não "https"; todas as outras partes do nome de domínio (incluindo porta, se houver alguma) devem ser o mesmo que para o suplemento.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p110">Invalid Resource. The add-in manifest hasn’t been configured correctly. Update the manifest. For more information, see [Validate and troubleshoot issues with your manifest](../testing/troubleshoot-manifest.md). The most commmon problem is that the **Resource** element (in the **WebApplicationInfo** element) has a domain that does not match the domain of the add-in. Although the protocol part of the Resource value should be "api" not "https"; all other parts of the domain name (including port, if any) should be the same as for the add-in.</span></span>

### <a name="13005"></a><span data-ttu-id="ebda6-156">13005</span><span class="sxs-lookup"><span data-stu-id="ebda6-156">13005</span></span>

<span data-ttu-id="ebda6-p111">Grant inválido. Geralmente, isso significa que o Office não foi pré-autorizados para web service do suplemento. Para obter mais informações, consulte [criar o aplicativo de serviço](sso-in-office-add-ins.md#create-the-service-application) e [registrar o suplemento com o ponto de extremidade do Azure AD v 2.0](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou [registrar o suplemento com o ponto de extremidade do Azure AD v 2.0](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (nó JS). Isso também pode acontecer se o usuário não tiver concedido a suas permissões de aplicativo de serviço para seus `profile`.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p111">Invalid Grant. This usually means that Office has not been pre-authorized to the add-in's web service. For more information, see [Create the service application](sso-in-office-add-ins.md#create-the-service-application) and [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS). This also may happen if the user has not granted your service application permissions to their `profile`.</span></span>

### <a name="13006"></a><span data-ttu-id="ebda6-161">13006</span><span class="sxs-lookup"><span data-stu-id="ebda6-161">13006</span></span>

<span data-ttu-id="ebda6-p112">Erro do cliente. Seu código deve sugerir para o usuário sair e reiniciar o Office ou reiniciar a sessão do Office Online.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p112">Client Error. Your code should suggest that the user sign out and restart Office, or restart the Office Online session.</span></span>

### <a name="13007"></a><span data-ttu-id="ebda6-164">13007</span><span class="sxs-lookup"><span data-stu-id="ebda6-164">13007</span></span>

<span data-ttu-id="ebda6-165">O host do Office não conseguiu obter um token de acesso ao serviço Web do suplemento.</span><span class="sxs-lookup"><span data-stu-id="ebda6-165">The Office host was unable to get an access token to the add-in's web service.</span></span>

- <span data-ttu-id="ebda6-p113">Se este erro ocorre durante o desenvolvimento, certifique-se de que seu registro do suplemento e o suplemento manifesto especificam o `openid` e `profile` permissões. Para obter mais informações, consulte [registrar o suplemento com o ponto de extremidade do Azure AD v 2.0](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou [registrar o suplemento com o ponto de extremidade do Azure AD v 2.0](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (nó JS) e [Configure o suplemento](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) ou [Configure o suplemento](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (nó JS).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p113">If this error occurs during development, be sure that your add-in registration and add-in manifest specify the `openid` and `profile` permissions. For more information, see [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), and [Configure the add-in](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) or [Configure the add-in](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span></span>
- <span data-ttu-id="ebda6-p114">Na produção, existem várias coisas que podem causar esse erro.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p114">In production, there are several things that can cause this error. Some of them are:</span></span>
    - <span data-ttu-id="ebda6-p115">O usuário tem revogado consentimento, após anteriormente concedendo-lo. Seu código deve se lembrar de `getAccessTokenAsync` método com a opção `forceConsent: true`, mas não mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p115">The user has revoked consent, after previously granting it. Your code should recall the `getAccessTokenAsync` method with the option `forceConsent: true`, but no more than once.</span></span>
    - <span data-ttu-id="ebda6-p116">O usuário é tem uma identidade de conta da Microsoft (MSA). Algumas situações em que pode causar um dos outros erros 13nnn com uma conta de trabalho ou escola, fará com que uma 13007 quando um MSA é usado.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p116">The user is has an Microsoft Account (MSA) identity. Some situations that would cause one of the other 13nnn errors with a Work or School account, will cause a 13007 when a MSA is used.</span></span> 

  <span data-ttu-id="ebda6-174">Em todos esses casos, se você já tentou a opção `forceConsent` uma vez, então seu código poderia sugerir que o usuário tente novamente a operação mais tarde.</span><span class="sxs-lookup"><span data-stu-id="ebda6-174">For all of these cases, if you have already tried the `forceConsent` option once, then your code could suggest that the user retry the operation later.</span></span>

### <a name="13008"></a><span data-ttu-id="ebda6-175">13008</span><span class="sxs-lookup"><span data-stu-id="ebda6-175">13008</span></span>

<span data-ttu-id="ebda6-p117">O usuário disparou uma operação que chama `getAccessTokenAsync` antes que uma chamada anterior de `getAccessTokenAsync` concluída. Seu código deve pedir ao usuário repita a operação após a operação anterior foi concluída.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p117">The user triggered an operation that calls `getAccessTokenAsync` before a previous call of `getAccessTokenAsync` completed. Your code should ask the user to repeat the operation after the previous operation has completed.</span></span>

### <a name="13009"></a><span data-ttu-id="ebda6-178">13009</span><span class="sxs-lookup"><span data-stu-id="ebda6-178">13009</span></span>

<span data-ttu-id="ebda6-p118">O suplemento chamado o `getAccessTokenAsync` método com a opção `forceConsent: true`, mas o manifesto do add-in é implantado em um tipo de catálogo que não suporta forçando consentimento. Seu código deve se lembrar de `getAccessTokenAsync` método e passar a opção `forceConsent: false` no parâmetro [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) . No entanto, a chamada de `getAccessTokenAsync` com `forceConsent: true` próprio pode ter sido uma resposta automática para uma chamada com falha de `getAccessTokenAsync` com `forceConsent: false`, portanto, seu código deve controlar se `getAccessTokenAsync` com `forceConsent: false` já foi chamado. Se ele tiver sido definido, seu código seja deve informar o usuário sair do Office e entrar novamente ou deve reverterá para um sistema alternativo de autenticação do usuário. Para obter mais informações, consulte [requisitos e práticas recomendadas](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p118">The add-in called the `getAccessTokenAsync` method with the option `forceConsent: true`, but the add-in's manifest is deployed to a type of catalog that does not support forcing consent. Your code should recall the `getAccessTokenAsync` method and pass the option `forceConsent: false` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter. However, the call of  `getAccessTokenAsync`  with `forceConsent: true` might itself have been an automatic response to a failed call of `getAccessTokenAsync` with `forceConsent: false`, so your code should keep track of whether `getAccessTokenAsync` with `forceConsent: false` has already been called. If it has, your code should either tell the user to sign out of Office and sign-in again or it should fall back to an alternate system of user authentication. For more information, see [Requirements and Best Practices](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span></span>

> [!NOTE]
> <span data-ttu-id="ebda6-p119">Microsoft não necessariamente imporá essa restrição em todos os tipos de catálogos de suplemento. Caso contrário, esse erro nunca será visto.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p119">Microsoft will not necessarily impose this restriction on any types of add-in catalogs. If it doesn't, then this error will never be seen.</span></span>

### <a name="13010"></a><span data-ttu-id="ebda6-186">13010</span><span class="sxs-lookup"><span data-stu-id="ebda6-186">13010</span></span>

<span data-ttu-id="ebda6-p120">O usuário está executando o add-in no Office Online e está usando o Internet Explorer ou borda. Domínio do Office 365 o usuário do e o domínio login.microsoftonline.com, estão em um zonas de segurança diferentes nas configurações do navegador. Se esse erro for retornado, o usuário será já vimos um erro explicando isso e vincular a uma página sobre como alterar a configuração de zona. Se o suplemento fornece funções que não exigem que o usuário estar conectado, seu código deve interceptar este erro e permitir que o suplemento permaneçam em execução.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p120">The user is running the add-in on Office Online and is using Edge or Internet Explorer. The user’s Office 365 domain, and the login.microsoftonline.com domain, are in a different security zones in the browser settings. If this error is returned, the user will have already seen an error explaining this and linking to a page about how to change the zone configuration. If your add-in provides functions that don't require the user to be signed in, then your code should catch this error and allow the add-in to stay running.</span></span>

### <a name="13012"></a><span data-ttu-id="ebda6-191">13012</span><span class="sxs-lookup"><span data-stu-id="ebda6-191">13012</span></span>

<span data-ttu-id="ebda6-p121">O suplemento é executado em uma plataforma que não oferece suporte a `getAccessTokenAsync` API. Por exemplo, não é suportado no iPad. Consulte também [conjuntos de requisito de APIs de identidade](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p121">The add-in is running on a platform that does not support the `getAccessTokenAsync` API. For example, it is not supported on iPad. See also [Identity API Requirement Sets](https://docs.microsoft.com/office/dev/add-ins/reference/requirement-sets/identity-api-requirement-sets).</span></span>

### <a name="50001"></a><span data-ttu-id="ebda6-195">50001</span><span class="sxs-lookup"><span data-stu-id="ebda6-195">50001</span></span>

<span data-ttu-id="ebda6-p122">Esse erro (que não é específica ao `getAccessTokenAsync`) pode indicar que o navegador tiver armazenado em cache uma cópia antiga dos arquivos do Office. js. Quando você estiver desenvolvendo, desmarque o cache do navegador. Também é possível que a versão do Office não é recente o suficiente para suportar o SSO. Consulte [pré-requisitos](create-sso-office-add-ins-aspnet.md#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p122">This error (which is not specific to `getAccessTokenAsync`) may indicate that the browser has cached an old copy of the office.js files. When you are developing, clear the browser's cache. Another possibility is that the version of Office is not recent enough to support SSO. See [Prerequisites](create-sso-office-add-ins-aspnet.md#prerequisites).</span></span>

<span data-ttu-id="ebda6-p123">Em um add-in de produção, o suplemento deve responder a esse erro voltando para um sistema alternativo de autenticação do usuário. Para obter mais informações, consulte [requisitos e práticas recomendadas](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p123">In a production add-in, the add-in should respond to this error by falling back to an alternate system of user authentication. For more information, see [Requirements and Best Practices](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span></span>


## <a name="errors-on-the-server-side-from-azure-active-directory"></a><span data-ttu-id="ebda6-202">Erros no lado do servidor do Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="ebda6-202">Errors on the server-side from Azure Active Directory</span></span>

<span data-ttu-id="ebda6-203">Para acessar exemplos de tratamento de erros descritos nesta seção, confira:</span><span class="sxs-lookup"><span data-stu-id="ebda6-203">For samples of the error-handling described in this section, see:</span></span>
- [<span data-ttu-id="ebda6-204">Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="ebda6-204">Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO)
- [<span data-ttu-id="ebda6-205">Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="ebda6-205">Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)


### <a name="conditional-access--multifactor-authentication-errors"></a><span data-ttu-id="ebda6-206">Erros no acesso condicional/autenticação multifatorial</span><span class="sxs-lookup"><span data-stu-id="ebda6-206">Conditional access / Multifactor authentication errors</span></span>
 
<span data-ttu-id="ebda6-p124">Em determinadas configurações de identidade nos AAD e o Office 365, é possível que alguns recursos que estão acessíveis com o Microsoft Graph para exigir a autenticação multifator (MFA), mesmo quando não inquilino do Office 365 do usuário. Quando AAD recebe uma solicitação para obter um token para o recurso MFA protegidos, via fluxo em nome de, ele retorna ao serviço da web do seu suplemento uma mensagem JSON que contém um `claims` propriedade. A propriedade declarações tem informações sobre quais fatores adicionais de autenticação são necessários.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p124">In certain configurations of identity in AAD and Office 365, it is possible for some resources that are accessible with Microsoft Graph to require multifactor authentication (MFA), even when the user's Office 365 tenancy does not. When AAD receives a request for a token to the MFA-protected resource, via the on-behalf-of flow, it returns to your add-in's web service a JSON message that contains a `claims` property. The claims property has information about what further authentication factors are needed.</span></span> 

<span data-ttu-id="ebda6-p125">Seu código do lado do servidor deve testar para esta mensagem e o valor de declarações para o seu código do lado do cliente de retransmissão. Você precisará dessas informações no cliente porque Office controla a autenticação para suplementos SSO. A mensagem para o cliente pode ser qualquer um erro (como `500 Server Error` ou `401 Unauthorized`) ou no corpo de uma resposta de sucesso (como `200 OK`). Em ambos os casos, o retorno de chamada (falha ou sucesso) do lado do cliente AJAX do seu código chamada para web da seu suplemento API deve ser testado para essa resposta. Se o valor de declarações tiver sido retransmitido, seu código deve lembrar `getAccessTokenAsync` e passe a opção `authChallenge: CLAIMS-STRING-HERE` no parâmetro [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) . Quando AAD vê esta cadeia de caracteres, ele solicita ao usuário o factor(s) adicionais e, em seguida, retorna um novo token de acesso que serão aceitos no fluxo de em nome de.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p125">Your server-side code should test for this message and relay the claims value to your client-side code. You need this information in the client because Office handles authentication for SSO add-ins. The message to the client can be either an error (such as `500 Server Error` or `401 Unauthorized`) or in the body of a success response (such as `200 OK`). In either case, the (failure or success) callback of your code's client-side AJAX call to your add-in's web API should test for this response. If the claims value has been relayed, your code should recall `getAccessTokenAsync` and pass the option `authChallenge: CLAIMS-STRING-HERE` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter. When AAD sees this string, it prompts the user for the additional factor(s) and then returns a new access token which will be accepted in the on-behalf-of flow.</span></span>

### <a name="consent-missing-errors"></a><span data-ttu-id="ebda6-215">Erros de falta de consentimento</span><span class="sxs-lookup"><span data-stu-id="ebda6-215">Consent missing errors</span></span>

<span data-ttu-id="ebda6-p126">Se AAD não tiver nenhum registro que consentimento (para o recurso do Microsoft Graph) foi concedida para o suplemento pelo usuário (ou administrador de locatários), AAD enviará uma mensagem de erro para seu serviço da web. Seu código deve instruir o cliente (no corpo de um `403 Forbidden` resposta, por exemplo) para cancelamento `getAccessTokenAsync` com o `forceConsent: true` opção.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p126">If AAD has no record that consent (to the Microsoft Graph resource) was granted to the add-in by the user (or tenant administrator), AAD will send an error message to your web service. Your code must tell the client (in the body of a `403 Forbidden` response, for example) to recall `getAccessTokenAsync` with the `forceConsent: true` option.</span></span>

### <a name="invalid-or-missing-scope-permission-errors"></a><span data-ttu-id="ebda6-218">Erros de escopo (permissões) inválido ou ausente</span><span class="sxs-lookup"><span data-stu-id="ebda6-218">Invalid or missing scope (permission) errors</span></span>

- <span data-ttu-id="ebda6-p127">Seu código do lado do servidor deve enviar a resposta `403 Forbidden` ao cliente, que deve apresentar uma mensagem amigável ao usuário. Se possível, registre o erro no console ou registre-o em um log.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p127">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user. If possible, log the error to the console or record it in a log.</span></span>
- <span data-ttu-id="ebda6-p128">Certifique-se de que seu suplemento [escopos](https://docs.microsoft.com/office/dev/add-ins/reference/manifest/scopes?view=office-js) seção manifesto especifica que todos necessárias permissões. E certifique-se de que seu registro do serviço de web do suplemento Especifica as mesmas permissões. Verifique se há erros de ortografia muito. Para obter mais informações, consulte [registrar o suplemento com o ponto de extremidade do Azure AD v 2.0](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou [registrar o suplemento com o ponto de extremidade do Azure AD v 2.0](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (nó JS) e [Configure o suplemento](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) ou [Configure o suplemento](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (nó JS).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p128">Be sure your add-in manifest [Scopes](https://docs.microsoft.com/office/dev/add-ins/reference/manifest/scopes?view=office-js)  section specifies all needed permissions. And be sure your registration of the add-in's web service specifies the same permissions. Check for spelling mistakes too. For more information, see [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), and [Configure the add-in](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) or [Configure the add-in](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span></span>

### <a name="expired-or-invalid-token-errors-when-calling-microsoft-graph"></a><span data-ttu-id="ebda6-225">Erros de token expirados ou inválidos ao chamar o Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="ebda6-225">Expired or invalid token errors when calling Microsoft Graph</span></span>

<span data-ttu-id="ebda6-p129">Algumas bibliotecas de autenticação e autorização, inclusive MSAL, evitar erros de tokens expirados usando um token de atualização de cache sempre que necessário. Você também pode codificar seu próprio sistema de armazenamento em cache de token. Para obter um exemplo que faz isso, consulte [Office suplemento NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), especialmente o arquivo [auth.ts](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/src/auth.ts).</span><span class="sxs-lookup"><span data-stu-id="ebda6-p129">Some authentication and authorization libraries, including MSAL, prevent expired token errors by using a cached refresh token whenever necessary. You can also code your own token caching system. For a sample that does this, see [Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), especially the file [auth.ts](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/src/auth.ts).</span></span>

<span data-ttu-id="ebda6-229">Mas, se você recebe um token expirado ou um erro de token inválido, seu código deve dizer ao cliente (no corpo de uma resposta `401 Unauthorized`, por exemplo) para chamar novamente o `getAccessTokenAsync` e repetir a chamada para o ponto de extremidade da API Web do suplemento, que repetirá o fluxo on-behalf-of para obter um novo token para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="ebda6-229">But if you get an expired token or invalid token error, your code must tell the client (in the body of a `401 Unauthorized` response, for example) to recall `getAccessTokenAsync` and repeat the call to the endpoint of your add-in's web API, which will repeat the on-behalf-of flow to obtain a new token for Microsoft Graph.</span></span> 

### <a name="invalid-token-error-when-calling-microsoft-graph"></a><span data-ttu-id="ebda6-230">Erro de token inválido ao chamar o Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="ebda6-230">Invalid token error when calling Microsoft Graph</span></span>

<span data-ttu-id="ebda6-p130">Trate esse erro da mesma forma que um erro de token expirado. Consulte a seção anterior.</span><span class="sxs-lookup"><span data-stu-id="ebda6-p130">Handle this error the same as an expired token error. See previous section.</span></span>

### <a name="invalid-audience-error"></a><span data-ttu-id="ebda6-233">Erro de audiência inválida</span><span class="sxs-lookup"><span data-stu-id="ebda6-233">Invalid audience error</span></span>

<span data-ttu-id="ebda6-234">Seu código do lado do servidor deve enviar uma resposta `403 Forbidden` ao cliente que apresente uma mensagem amigável ao usuário e, possivelmente, também registrar o erro no console ou gravá-lo em um registro.</span><span class="sxs-lookup"><span data-stu-id="ebda6-234">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user and possibly also log the error to the console or record it in a log.</span></span>

<span data-ttu-id="ebda6-235">Para obter mais informações sobre como adicionar suporte para validação de token por vários locatários, consulte a [Exemplo do Azure Multitenant](https://github.com/Azure-Samples/active-directory-dotnet-webapp-webapi-multitenant-openidconnect).</span><span class="sxs-lookup"><span data-stu-id="ebda6-235">For more on adding multitenant support for token validation, see the [Azure Multitenant Sample](https://github.com/Azure-Samples/active-directory-dotnet-webapp-webapi-multitenant-openidconnect).</span></span>
