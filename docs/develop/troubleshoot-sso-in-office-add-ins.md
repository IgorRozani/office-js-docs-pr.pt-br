---
title: Solucionar problemas de mensagens de erro no logon único (SSO)
description: ''
ms.date: 12/08/2017
ms.openlocfilehash: 270cc2c636f982d271f22fa93415515dbc63ad43
ms.sourcegitcommit: fdf7f4d686700edd6e6b04b2ea1bd43e59d4a03a
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/28/2018
ms.locfileid: "25348174"
---
# <a name="troubleshoot-error-messages-for-single-sign-on-sso-preview"></a><span data-ttu-id="afe6c-102">Solucionar problemas de mensagens de erro no logon único (SSO) (versão prévia)</span><span class="sxs-lookup"><span data-stu-id="afe6c-102">Troubleshoot error messages for single sign-on (SSO) (preview)</span></span>

<span data-ttu-id="afe6c-103">Este artigo fornece algumas orientações sobre como solucionar problemas com o logon único (SSO) nos suplementos do Office e como fazer com que seu suplemento habilitado para SSO trate de forma robusta os erros ou condições especiais.</span><span class="sxs-lookup"><span data-stu-id="afe6c-103">This article provides some guidance about how to troubleshoot problems with single sign-on (SSO) in Office Add-ins, and how to make your SSO-enabled add-in robustly handle special conditions or errors.</span></span>

> [!NOTE]
> <span data-ttu-id="afe6c-104">Atualmente a API de logon único tem suporte para Word, Excel e PowerPoint.</span><span class="sxs-lookup"><span data-stu-id="afe6c-104">The Single Sign-on API is currently supported in preview for Word, Excel, Outlook, and PowerPoint.</span></span> <span data-ttu-id="afe6c-105">Para obter mais informações sobre onde a API de logon único é suportada no momento, confira [conjuntos de requisitos IdentityAPI]https://docs.microsoft.com/javascript/office/requirement-sets/identity-api-requirement-sets).</span><span class="sxs-lookup"><span data-stu-id="afe6c-105">For more information about where the Single Sign-on API is currently supported, see https://docs.microsoft.com/javascript/office/requirement-sets/identity-api-requirement-sets).</span></span>
> <span data-ttu-id="afe6c-106">Para usar SSO, você precisa carregar a versão beta da Biblioteca JavaScript para Office de https://appsforoffice.microsoft.com/lib/beta/hosted/office.js na página HTML de inicialização do suplemento.</span><span class="sxs-lookup"><span data-stu-id="afe6c-106">To use SSO, you must load the beta version of the Office JavaScript Library from https://appsforoffice.microsoft.com/lib/beta/hosted/office.js in the startup HTML page of the add-in.</span></span>
> <span data-ttu-id="afe6c-107">Se você estiver trabalhando com um suplemento do Outlook, certifique-se de habilitar a Autenticação Moderna para a locação do Office 365.</span><span class="sxs-lookup"><span data-stu-id="afe6c-107">If you are working with an Outlook add-in, be sure to enable Modern Authentication for the Office 365 tenancy.</span></span> <span data-ttu-id="afe6c-108">Confira mais informações sobre como fazer isso em [Exchange Online: como habilitar seu locatário para autenticação moderna](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span><span class="sxs-lookup"><span data-stu-id="afe6c-108">For information about how to do this, see [Exchange Online: How to enable your tenant for modern authentication](https://social.technet.microsoft.com/wiki/contents/articles/32711.exchange-online-how-to-enable-your-tenant-for-modern-authentication.aspx).</span></span>

## <a name="debugging-tools"></a><span data-ttu-id="afe6c-109">Ferramentas de depuração</span><span class="sxs-lookup"><span data-stu-id="afe6c-109">Debugging tools</span></span>

<span data-ttu-id="afe6c-p102">Quando estiver desenvolvendo, é altamente recomendável que use uma ferramenta que possa interceptar e exibir as solicitações e respostas HTTP do serviço web do seu suplemento. Duas das mais populares são:</span><span class="sxs-lookup"><span data-stu-id="afe6c-p102">We strongly recommend that you use a tool that can intercept and display the HTTP Requests from, and Responses to, your add-in's web service when you are developing. Two of the most popular are:</span></span> 

- <span data-ttu-id="afe6c-112">[Fiddler](http://www.telerik.com/fiddler): Gratuita ([Documentação](http://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span><span class="sxs-lookup"><span data-stu-id="afe6c-112">[Fiddler](http://www.telerik.com/fiddler): Free ([Documentation](http://docs.telerik.com/fiddler/configure-fiddler/tasks/configurefiddler))</span></span>
- <span data-ttu-id="afe6c-p103">[Charles](https://www.charlesproxy.com/): Gratuita por 30 dias. ([Documentação](https://www.charlesproxy.com/documentation/))</span><span class="sxs-lookup"><span data-stu-id="afe6c-p103">[Charles](https://www.charlesproxy.com/): Free for 30 days. ([Documenation](https://www.charlesproxy.com/documentation/))</span></span>

<span data-ttu-id="afe6c-115">Ao desenvolver sua API de serviço, também pode tentar:</span><span class="sxs-lookup"><span data-stu-id="afe6c-115">When developing your service API, you may also want to try:</span></span>

- <span data-ttu-id="afe6c-116">[Postman](http://www.getpostman.com/postman): Gratuita ([Documentação](https://www.getpostman.com/docs/))</span><span class="sxs-lookup"><span data-stu-id="afe6c-116">[Postman](http://www.getpostman.com/postman): Free ([Documentation](https://www.getpostman.com/docs/))</span></span>

## <a name="causes-and-handling-of-errors-from-getaccesstokenasync"></a><span data-ttu-id="afe6c-117">Causas e tratamento dos erros do getAccessTokenAsync</span><span class="sxs-lookup"><span data-stu-id="afe6c-117">Causes and handling of errors from getAccessTokenAsync</span></span>

<span data-ttu-id="afe6c-118">Para acessar exemplos de manipulação dos erros descritos nesta seção, confira:</span><span class="sxs-lookup"><span data-stu-id="afe6c-118">For examples of the error handling described in this section, see:</span></span>
- [<span data-ttu-id="afe6c-119">Home.js em Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="afe6c-119">Home.js in Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO/blob/master/Complete/Office-Add-in-ASPNET-SSO-WebAPI/Scripts/Home.js)
- [<span data-ttu-id="afe6c-120">program.js em Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="afe6c-120">program.js in Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/public/program.js)

> [!NOTE]
> <span data-ttu-id="afe6c-121">Além das sugestões feitas nesta seção, um suplemento do Outlook tem uma maneira adicional de responder a qualquer erro 13*nnn*.</span><span class="sxs-lookup"><span data-stu-id="afe6c-121">Besides the suggestions made in this section, an Outlook add-in has an additional way to respond to any 13*nnn* error.</span></span> <span data-ttu-id="afe6c-122">Para detalhes, consulte [Cenário: implementar o logon único para seu serviço em um suplemento do Outlook](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in) e [Exemplo de Suplemento AttachmentsDemo](https://github.com/OfficeDev/outlook-add-in-attachments-demo).</span><span class="sxs-lookup"><span data-stu-id="afe6c-122">For more details, see [Scenario: Implement single sign-on to your service in an Outlook Add-in](https://docs.microsoft.com/outlook/add-ins/implement-sso-in-outlook-add-in).</span></span> 

### <a name="13000"></a><span data-ttu-id="afe6c-123">13000</span><span class="sxs-lookup"><span data-stu-id="afe6c-123">13000</span></span>

<span data-ttu-id="afe6c-124">A API [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) não é suportada pelo suplemento ou pela versão do Office.</span><span class="sxs-lookup"><span data-stu-id="afe6c-124">The [getAccessTokenAsync](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) API is not supported by the add-in or the Office version.</span></span> 

- <span data-ttu-id="afe6c-p105">A versão do Office não suporta SSO. A versão necessária é o Office 2016, versão 1710, compilação 8629.nnnn ou posterior (a versão de assinatura do Office 365, às vezes chamada de "Clique para Executar"). É possível que precise participar do programa Office Insider para obter essa versão. Para saber mais, confira a página [Seja um Office Insider](https://products.office.com/office-insider?tab=tab-1).</span><span class="sxs-lookup"><span data-stu-id="afe6c-p105">The version of Office does not support SSO. The required version is Office 2016, Version 1710, build 8629.nnnn or later (the Office 365 subscription version, sometimes called “Click to Run”). You might need to be an Office Insider to get this version. For more information, see [Be an Office Insider](https://products.office.com/office-insider?tab=tab-1).</span></span> 
- <span data-ttu-id="afe6c-129">No manifesto do suplemento está faltando a seção [WebApplicationInfo](https://docs.microsoft.com/javascript/office/manifest/webapplicationinfo?view=office-js) apropriada.</span><span class="sxs-lookup"><span data-stu-id="afe6c-129">The add-in manifest is missing the proper [WebApplicationInfo](https://docs.microsoft.com/javascript/office/manifest/webapplicationinfo?view=office-js) section.</span></span>

<span data-ttu-id="afe6c-130">Seu suplemento deve responder a esse erro voltando para um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="afe6c-130">Your add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="afe6c-131">Para obter mais informações, consulte [Requisitos e práticas recomendadas](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="afe6c-131">For more information, see [Screener Questions Best Practices.](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices)</span></span>

### <a name="13001"></a><span data-ttu-id="afe6c-132">13001</span><span class="sxs-lookup"><span data-stu-id="afe6c-132">13001</span></span>

<span data-ttu-id="afe6c-133">O usuário não iniciou uma sessão no Office.</span><span class="sxs-lookup"><span data-stu-id="afe6c-133">The user is not signed into Office.</span></span> <span data-ttu-id="afe6c-134">Seu código deve chamar novamente o método `getAccessTokenAsync` e passar a opção `forceAddAccount: true` no parâmetro [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference).</span><span class="sxs-lookup"><span data-stu-id="afe6c-134">Your code should recall the `getAccessTokenAsync` method and pass the option `forceAddAccount: true` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="afe6c-135">Porém, não faça isso mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="afe6c-135">But don't do this more than once.</span></span> <span data-ttu-id="afe6c-136">O usuário pode ter decidido não fazer login.</span><span class="sxs-lookup"><span data-stu-id="afe6c-136">The user may have decided not to sign-in.</span></span>

<span data-ttu-id="afe6c-137">Este erro nunca é visto no Office Online.</span><span class="sxs-lookup"><span data-stu-id="afe6c-137">This error is never seen in Office Online.</span></span> <span data-ttu-id="afe6c-138">Se o cookie do usuário expirar, o Office Online retornará o erro 13006.</span><span class="sxs-lookup"><span data-stu-id="afe6c-138">If the user's cookie expires, Office Online returns error 13006.</span></span> 

### <a name="13002"></a><span data-ttu-id="afe6c-139">13002</span><span class="sxs-lookup"><span data-stu-id="afe6c-139">13002</span></span>

<span data-ttu-id="afe6c-140">O usuário cancelou a sessão ou consentiu; por exemplo, escolhendo **Cancelar** no diálogo de consentimento.</span><span class="sxs-lookup"><span data-stu-id="afe6c-140">The user aborted sign in or consent; for example, by choosing **Cancel** on the consent dialog.</span></span> 

- <span data-ttu-id="afe6c-141">Se o suplemento fornece funções que não exigem que o usuário esteja conectado (ou que tenha concedido consentimento), seu código deve capturar esse erro e permitir que o suplemento permaneça em execução.</span><span class="sxs-lookup"><span data-stu-id="afe6c-141">If your add-in provides functions that don't require the user to be signed in (or to have granted consent), then your code should catch this error and allow the add-in to stay running.</span></span>
- <span data-ttu-id="afe6c-142">Se o suplemento exige um usuário conectado que concedeu consentimento, seu código deverá solicitar ao usuário que repita a operação, mas não mais de uma vez.</span><span class="sxs-lookup"><span data-stu-id="afe6c-142">If the add-in requires a signed-in user who has granted consent, your code should ask the user to repeat the operation, but not more than once.</span></span> 

### <a name="13003"></a><span data-ttu-id="afe6c-143">13003</span><span class="sxs-lookup"><span data-stu-id="afe6c-143">13003</span></span>

<span data-ttu-id="afe6c-144">Tipo de Usuário não suportado.</span><span class="sxs-lookup"><span data-stu-id="afe6c-144">User Type not supported.</span></span> <span data-ttu-id="afe6c-145">O usuário não está conectado ao Office com uma conta válida da Microsoft ou do Office 365 ("Corporativa ou de Estudante").</span><span class="sxs-lookup"><span data-stu-id="afe6c-145">The user isn't signed into Office with a valid Microsoft Account or Work or School account.</span></span> <span data-ttu-id="afe6c-146">Isso pode acontecer, por exemplo, se o Office for executado com uma conta de domínio local.</span><span class="sxs-lookup"><span data-stu-id="afe6c-146">This may happen if Office runs with an on-premises domain account, for example.</span></span> <span data-ttu-id="afe6c-147">Seu código deve pedir ao usuário para entrar no Office ou voltar a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="afe6c-147">Your code should either ask the user to sign in to Office or fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="afe6c-148">Para obter mais informações, consulte [Requisitos e práticas recomendadas](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="afe6c-148">For more information, see [Screener Questions Best Practices.](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices)</span></span>


### <a name="13004"></a><span data-ttu-id="afe6c-149">13004</span><span class="sxs-lookup"><span data-stu-id="afe6c-149">13004</span></span>

<span data-ttu-id="afe6c-150">Recurso inválido.</span><span class="sxs-lookup"><span data-stu-id="afe6c-150">Invalid Resource.</span></span> <span data-ttu-id="afe6c-151">O manifesto do suplemento não foi configurado corretamente.</span><span class="sxs-lookup"><span data-stu-id="afe6c-151">The add-in manifest hasn’t been configured correctly.</span></span> <span data-ttu-id="afe6c-152">Atualizar o manifesto.</span><span class="sxs-lookup"><span data-stu-id="afe6c-152">Update the manifest.</span></span> <span data-ttu-id="afe6c-153">Para obter mais informações, confira [Validar e solucionar problemas com seu manifesto](../testing/troubleshoot-manifest.md).</span><span class="sxs-lookup"><span data-stu-id="afe6c-153">For more information, see [Validate and troubleshoot issues with your manifest](../testing/troubleshoot-manifest.md).</span></span> <span data-ttu-id="afe6c-154">O problema mais comum é que o elemento **Recurso** (no elemento **WebApplicationInfo**) tem um domínio que não corresponde ao domínio do suplemento.</span><span class="sxs-lookup"><span data-stu-id="afe6c-154">The most commmon problem is that the **Resource** element (in the **WebApplicationInfo** element) has a domain that does not match the domain of the add-in.</span></span> <span data-ttu-id="afe6c-155">Apesar de que a parte do protocolo do valor do recurso deve ser "api" e não "https", todas as outras partes do nome de domínio (incluindo a porta, se houver) devem ser as mesmas do suplemento.</span><span class="sxs-lookup"><span data-stu-id="afe6c-155">Although the protocol part of the Resource value should be "api" not "https"; all other parts of the domain name (including port, if any) should be the same as for the add-in.</span></span>

### <a name="13005"></a><span data-ttu-id="afe6c-156">13005</span><span class="sxs-lookup"><span data-stu-id="afe6c-156">13005</span></span>

<span data-ttu-id="afe6c-157">Concessão inválida.</span><span class="sxs-lookup"><span data-stu-id="afe6c-157">Invalid Grant.</span></span> <span data-ttu-id="afe6c-158">Isso geralmente significa que o Office não foi pré-autorizado para o serviço Web do suplemento.</span><span class="sxs-lookup"><span data-stu-id="afe6c-158">This usually means that Office has not been pre-authorized to the add-in's web service.</span></span> <span data-ttu-id="afe6c-159">Para obter mais informações, consulte [Criar o aplicativo de serviço](sso-in-office-add-ins.md#create-the-service-application) e [Registrar o suplemento com o ponto de extremidade v2.0 do Azure AD](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou [Registrar o suplemento com o ponto de extremidade v2.0 do Azure AD](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS).</span><span class="sxs-lookup"><span data-stu-id="afe6c-159">For more information, see [Create the service application](sso-in-office-add-ins.md#create-the-service-application) and [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS).</span></span> <span data-ttu-id="afe6c-160">Isso também pode acontecer caso o usuário não tenha concedido as permissões de aplicativo de serviço para seu `profile`.</span><span class="sxs-lookup"><span data-stu-id="afe6c-160">This also may happen if the user has not granted your service application permissions to his or her `profile`.</span></span>

### <a name="13006"></a><span data-ttu-id="afe6c-161">13006</span><span class="sxs-lookup"><span data-stu-id="afe6c-161">13006</span></span>

<span data-ttu-id="afe6c-p112">Erro do cliente. Seu código deve sugerir para o usuário sair e reiniciar o Office ou reiniciar a sessão do Office Online.</span><span class="sxs-lookup"><span data-stu-id="afe6c-p112">Client Error. Your code should suggest that the user sign out and restart Office, or restart the Office Online session.</span></span>

### <a name="13007"></a><span data-ttu-id="afe6c-164">13007</span><span class="sxs-lookup"><span data-stu-id="afe6c-164">13007</span></span>

<span data-ttu-id="afe6c-165">O host do Office não conseguiu obter um token de acesso ao serviço Web do suplemento.</span><span class="sxs-lookup"><span data-stu-id="afe6c-165">The Office host was unable to get an access token to the add-in's web service.</span></span>

- <span data-ttu-id="afe6c-166">Se esse erro ocorrer durante o desenvolvimento, certifique-se de que o registro e o manifesto do suplemento especifiquem as permissões `openid` e `profile`.</span><span class="sxs-lookup"><span data-stu-id="afe6c-166">If this error occurs during development, be sure that your add-in registration and add-in manifest specify the `openid` and `profile` permissions.</span></span> <span data-ttu-id="afe6c-167">Para obter mais informações, consulte [Registrar o suplemento com o ponto de extremidade v2.0 do Azure AD](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou [Registrar o suplemento com o ponto de extremidade v2.0 do Azure AD](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), e [Configurar o suplemento](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) ou [Configurar o suplemento](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span><span class="sxs-lookup"><span data-stu-id="afe6c-167">For more information, see [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), and [Configure the add-in](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) or [Configure the add-in](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span></span>
- <span data-ttu-id="afe6c-168">Na produção, existem várias coisas que podem causar esse erro.</span><span class="sxs-lookup"><span data-stu-id="afe6c-168">In production, there are several things that can cause this error.</span></span> <span data-ttu-id="afe6c-169">Algumas são:</span><span class="sxs-lookup"><span data-stu-id="afe6c-169">Some of them are:</span></span>
    - <span data-ttu-id="afe6c-170">O usuário revogou o consentimento, após concedê-lo anteriormente.</span><span class="sxs-lookup"><span data-stu-id="afe6c-170">The user has revoked consent, after previously granting it.</span></span> <span data-ttu-id="afe6c-171">Seu código deve chamar novamente o `getAccessTokenAsync` método com a opção `forceConsent: true`, mas não mais que uma vez.</span><span class="sxs-lookup"><span data-stu-id="afe6c-171">Your code should recall the `getAccessTokenAsync` method with the option `forceConsent: true`, but no more than once.</span></span>
    - <span data-ttu-id="afe6c-172">O usuário tem uma identidade de conta da Microsoft (MSA).</span><span class="sxs-lookup"><span data-stu-id="afe6c-172">The user is has an Microsoft Account (MSA) identity.</span></span> <span data-ttu-id="afe6c-173">Algumas situações que causariam um dos outros erros 13nnn com uma conta Work ou School causarão um 13007 quando um MSA for usado.</span><span class="sxs-lookup"><span data-stu-id="afe6c-173">Some situations that would cause one of the other 13nnn errors with a Work or School account, will cause a 13007 when a MSA is used.</span></span> 

  <span data-ttu-id="afe6c-174">Em todos esses casos, se você já tentou a opção `forceConsent` uma vez, então seu código poderia sugerir que o usuário tente novamente a operação mais tarde.</span><span class="sxs-lookup"><span data-stu-id="afe6c-174">For all of these cases, if you have already tried the `forceConsent` option once, then your code could suggest that the user retry the operation later.</span></span>

### <a name="13008"></a><span data-ttu-id="afe6c-175">13008</span><span class="sxs-lookup"><span data-stu-id="afe6c-175">13008</span></span>

<span data-ttu-id="afe6c-176">O usuário acionou uma operação que chama o `getAccessTokenAsync` antes de uma chamada anterior concluída do `getAccessTokenAsync` .</span><span class="sxs-lookup"><span data-stu-id="afe6c-176">The user triggered an operation that calls `getAccessTokenAsync` before a previous call of `getAccessTokenAsync` completed.</span></span> <span data-ttu-id="afe6c-177">Seu código deve solicitar ao usuário que repita a operação após a conclusão da operação anterior.</span><span class="sxs-lookup"><span data-stu-id="afe6c-177">Your code should ask the user to repeat the operation after the previous operation has completed.</span></span>

### <a name="13009"></a><span data-ttu-id="afe6c-178">13009</span><span class="sxs-lookup"><span data-stu-id="afe6c-178">13009</span></span>

<span data-ttu-id="afe6c-179">O suplemento chamou o método `getAccessTokenAsync` com a opção `forceConsent: true`, mas o manifesto do suplemento é implantado para um tipo de catálogo que não oferece suporte para forçar o consentimento.</span><span class="sxs-lookup"><span data-stu-id="afe6c-179">The add-in called the `getAccessTokenAsync` method with the option `forceConsent: true`, but the add-in's manifest is deployed to a type of catalog that does not support forcing consent.</span></span> <span data-ttu-id="afe6c-180">Seu código deve chamar novamente o método `getAccessTokenAsync` e passar a opção `forceConsent: false` no parâmetro [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference).</span><span class="sxs-lookup"><span data-stu-id="afe6c-180">Your code should recall the `getAccessTokenAsync` method and pass the option `forceConsent: false` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="afe6c-181">No entanto, a chamada de `getAccessTokenAsync` com `forceConsent: true` pode ser uma resposta automática para uma falha de chamada de `getAccessTokenAsync` com `forceConsent: false`, portanto, seu código deve monitorar se `getAccessTokenAsync` com `forceConsent: false` já foi chamado.</span><span class="sxs-lookup"><span data-stu-id="afe6c-181">However, the call of  `getAccessTokenAsync`  with `forceConsent: true` might itself have been an automatic response to a failed call of `getAccessTokenAsync` with `forceConsent: false`, so your code should keep track of whether `getAccessTokenAsync` with `forceConsent: false` has already been called.</span></span> <span data-ttu-id="afe6c-182">Se foi, seu código deve instruir o usuário a sair do Office e entrar novamente ou deve retornar a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="afe6c-182">If it has, your code should either tell the user to sign out of Office and sign-in again or it should fall back to an alternate system of user authentication.</span></span> <span data-ttu-id="afe6c-183">Para obter mais informações, consulte [Requisitos e práticas recomendadas](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="afe6c-183">For more information, see [Screener Questions Best Practices.](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#requirements-and-best-practices)</span></span>

> [!NOTE]
> <span data-ttu-id="afe6c-184">A Microsoft não impõe, necessariamente, essa restrição a nenhum tipo de catálogo de suplementos.</span><span class="sxs-lookup"><span data-stu-id="afe6c-184">Microsoft will not necessarilly impose this restriction on any types of add-in catalogs.</span></span> <span data-ttu-id="afe6c-185">Nesse caso, esse erro nunca será exibido.</span><span class="sxs-lookup"><span data-stu-id="afe6c-185">If it doesn't, then this error will never be seen.</span></span>

### <a name="13010"></a><span data-ttu-id="afe6c-186">13010</span><span class="sxs-lookup"><span data-stu-id="afe6c-186">13010</span></span>

<span data-ttu-id="afe6c-187">O usuário está executando o suplemento no Office Online e usando o Edge ou o Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="afe6c-187">The user is running the add-in on Office Online and is using Edge or Internet Explorer.</span></span> <span data-ttu-id="afe6c-188">O domínio de usuário do Office 365 e o domínio login.microsoftonline.com estão em zonas de segurança diferentes nas configurações do navegador.</span><span class="sxs-lookup"><span data-stu-id="afe6c-188">The user’s Office 365 domain, and the login.microsoftonline.com domain, are in a different security zones in the browser settings.</span></span> <span data-ttu-id="afe6c-189">Se retornar esse erro, o usuário verá uma mensagem explicando o erro com o vínculo para uma página sobre como alterar a configuração da zona.</span><span class="sxs-lookup"><span data-stu-id="afe6c-189">If this error is returned, the user will have already seen an error explaining this and linking to a page about how to change the zone configuration.</span></span> <span data-ttu-id="afe6c-190">Se o seu suplemento fornece funções que não exigem que o usuário esteja conectado, o código deve capturar esse erro e permitir que o suplemento permaneça em execução.</span><span class="sxs-lookup"><span data-stu-id="afe6c-190">If your add-in provides functions that don't require the user to be signed in, then your code should catch this error and allow the add-in to stay running.</span></span>

### <a name="13012"></a><span data-ttu-id="afe6c-191">13012</span><span class="sxs-lookup"><span data-stu-id="afe6c-191">13012</span></span>

<span data-ttu-id="afe6c-192">O suplemento está sendo executado em uma plataforma que não oferece suporte à API `getAccessTokenAsync`.</span><span class="sxs-lookup"><span data-stu-id="afe6c-192">The add-in is running on a platform that does not support the `getAccessTokenAsync` API.</span></span> <span data-ttu-id="afe6c-193">Por exemplo, não é suportado no iPad.</span><span class="sxs-lookup"><span data-stu-id="afe6c-193">For example, it is not supported on iPad.</span></span> <span data-ttu-id="afe6c-194">Confira também [Conjuntos de requisitos de APIs de identidade](https://docs.microsoft.com/javascript/office/requirement-sets/identity-api-requirement-sets).</span><span class="sxs-lookup"><span data-stu-id="afe6c-194">See also [Identity API Requirement Sets](https://docs.microsoft.com/javascript/office/requirement-sets/identity-api-requirement-sets).</span></span>

### <a name="50001"></a><span data-ttu-id="afe6c-195">50001</span><span class="sxs-lookup"><span data-stu-id="afe6c-195">50001</span></span>

<span data-ttu-id="afe6c-196">Esse erro (que não é específico de `getAccessTokenAsync`) pode indicar que o navegador armazenou em cache uma cópia antiga dos arquivos office.js.</span><span class="sxs-lookup"><span data-stu-id="afe6c-196">This error (which is not specific to `getAccessTokenAsync`) may indicate that the browser has cashed an old copy of the office.js files.</span></span> <span data-ttu-id="afe6c-197">Quando você estiver desenvolvendo, desmarque o cache do navegador.</span><span class="sxs-lookup"><span data-stu-id="afe6c-197">When you are developing, clear the browser's cache.</span></span> <span data-ttu-id="afe6c-198">Outra possibilidade é que a versão do Office esteja desatualizada e não suporte SSO.</span><span class="sxs-lookup"><span data-stu-id="afe6c-198">Another possibility is that the version of Office is not recent enough to support SSO.</span></span> <span data-ttu-id="afe6c-199">Consulte [Pré-requisitos](create-sso-office-add-ins-aspnet.md#prerequisites).</span><span class="sxs-lookup"><span data-stu-id="afe6c-199">See [Prerequisites](create-sso-office-add-ins-aspnet.md#prerequisites).</span></span>

<span data-ttu-id="afe6c-200">Em produção, o suplemento deve responder a esse erro retornando a um sistema alternativo de autenticação de usuário.</span><span class="sxs-lookup"><span data-stu-id="afe6c-200">In a production add-in, the add-in should respond to this error by falling back to an alternate system of user authentication.</span></span> <span data-ttu-id="afe6c-201">Para obter mais informações, consulte [Requisitos e práticas recomendadas](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices).</span><span class="sxs-lookup"><span data-stu-id="afe6c-201">For more information, see [Screener Questions Best Practices.](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins##requirements-and-best-practices)</span></span>


## <a name="errors-on-the-server-side-from-azure-active-directory"></a><span data-ttu-id="afe6c-202">Erros no servidor do Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="afe6c-202">Errors on the server-side from Azure Active Directory</span></span>

<span data-ttu-id="afe6c-203">Para acessar exemplos de tratamento de erros descritos nesta seção, confira:</span><span class="sxs-lookup"><span data-stu-id="afe6c-203">For samples of the error-handling described in this section, see:</span></span>
- [<span data-ttu-id="afe6c-204">Office-Add-in-ASPNET-SSO</span><span class="sxs-lookup"><span data-stu-id="afe6c-204">Office-Add-in-ASPNET-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-ASPNET-SSO)
- [<span data-ttu-id="afe6c-205">Office-Add-in-NodeJS-SSO</span><span class="sxs-lookup"><span data-stu-id="afe6c-205">Office-Add-in-NodeJS-SSO</span></span>](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO)


### <a name="conditional-access--multifactor-authentication-errors"></a><span data-ttu-id="afe6c-206">Erros no acesso condicional/autenticação multifatorial</span><span class="sxs-lookup"><span data-stu-id="afe6c-206">Conditional access / Multifactor authentication errors</span></span>
 
<span data-ttu-id="afe6c-207">Em certas configurações de identidade no AAD e no Office 365, é possível que alguns recursos que podem ser acessados com o Microsoft Graph exijam autenticação multifatorial (MFA), mesmo que o locatário do usuário do Office 365 não a exija.</span><span class="sxs-lookup"><span data-stu-id="afe6c-207">In certain configurations of identity in AAD and Office 365, it is possible for some resources that are accessible with Microsoft Graph to require multifactor authentication (MFA), even when the user's Office 365 tenancy does not.</span></span> <span data-ttu-id="afe6c-208">Quando o AAD recebe uma solicitação de um token para o recurso protegido por MFA por meio do fluxo on-behalf-of, retorna ao serviço Web do suplemento uma mensagem JSON que contém uma propriedade `claims`.</span><span class="sxs-lookup"><span data-stu-id="afe6c-208">When AAD receives a request for a token to the MFA-protected resource, via the on-behalf-of flow, it returns to your add-in's web service a JSON message that contains a `claims` property.</span></span> <span data-ttu-id="afe6c-209">A propriedade de declarações possui informações sobre quais outros fatores de autenticação são necessários.</span><span class="sxs-lookup"><span data-stu-id="afe6c-209">The claims property has information about what further authentication factors are needed.</span></span> 

<span data-ttu-id="afe6c-210">Seu código servidor deve testar essa mensagem e transmitir o valor das declarações para o código do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="afe6c-210">Your server-side code should test for this message and relay the claims value to your client-side code.</span></span> <span data-ttu-id="afe6c-211">Você precisa dessa informação no cliente porque o Office processa a autenticação para os suplementos de SSO. A mensagem para o cliente pode ser um erro (como `500 Server Error` ou `401 Unauthorized`) ou estar no corpo de uma resposta bem sucedida (como `200 OK`).</span><span class="sxs-lookup"><span data-stu-id="afe6c-211">You need this information in the client because Office handles authentication for SSO add-ins. The message to the client can be either an error (such as `500 Server Error` or `401 Unauthorized`) or in the body of a success response (such as `200 OK`).</span></span> <span data-ttu-id="afe6c-212">Em ambos os casos, o retorno da chamada AJAX do seu código do lado do cliente (falha ou sucesso) para o suplemento da API Web deve testar essa resposta.</span><span class="sxs-lookup"><span data-stu-id="afe6c-212">In either case, the (failure or success) callback of your code's client-side AJAX call to your add-in's web API should test for this response.</span></span> <span data-ttu-id="afe6c-213">Se o valor de claims for retransmitido, seu código deve chamar novamente o `getAccessTokenAsync` e passar a opção `authChallenge: CLAIMS-STRING-HERE` no parâmetro [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference).</span><span class="sxs-lookup"><span data-stu-id="afe6c-213">If the claims value has been relayed, your code should recall `getAccessTokenAsync` and pass the option `authChallenge: CLAIMS-STRING-HERE` in the [options](https://docs.microsoft.com/office/dev/add-ins/develop/sso-in-office-add-ins#sso-api-reference) parameter.</span></span> <span data-ttu-id="afe6c-214">Quando o AAD vê essa sequência, solicita ao usuário os fatores adicionais e, em seguida, retorna um novo token de acesso que será aceito no fluxo on-behalf-of.</span><span class="sxs-lookup"><span data-stu-id="afe6c-214">When AAD sees this string, it prompts the user for the additional factor(s) and then returns a new access token which will be accepted in the on-behalf-of flow.</span></span>

### <a name="consent-missing-errors"></a><span data-ttu-id="afe6c-215">Erros de falta de consentimento</span><span class="sxs-lookup"><span data-stu-id="afe6c-215">Consent missing errors</span></span>

<span data-ttu-id="afe6c-216">Se o AAD não tiver um registro de que o consentimento (para o recurso do Microsoft Graph) foi concedido ao suplemento pelo usuário (ou administrador do locatário), o AAD enviará uma mensagem de erro ao seu serviço Web.</span><span class="sxs-lookup"><span data-stu-id="afe6c-216">If AAD has no record that consent (to the Microsoft Graph resource) was granted to the add-in by the user (or tenant administrator), AAD will send an error message to your web service.</span></span> <span data-ttu-id="afe6c-217">Seu código deve dizer ao cliente (no corpo de uma resposta `403 Forbidden`, por exemplo) para chamar novamente o `getAccessTokenAsync` com a opção `forceConsent: true`.</span><span class="sxs-lookup"><span data-stu-id="afe6c-217">Your code must tell the client (in the body of a `403 Forbidden` response, for example) to recall `getAccessTokenAsync` with the `forceConsent: true` option.</span></span>

### <a name="invalid-or-missing-scope-permission-errors"></a><span data-ttu-id="afe6c-218">Erros de escopo (permissões) inválido ou ausente</span><span class="sxs-lookup"><span data-stu-id="afe6c-218">Invalid or missing scope (permission) errors</span></span>

- <span data-ttu-id="afe6c-p127">Seu código do lado do servidor deve enviar a resposta `403 Forbidden` ao cliente, que deve apresentar uma mensagem amigável ao usuário. Se possível, registre o erro no console ou registre-o em um log.</span><span class="sxs-lookup"><span data-stu-id="afe6c-p127">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user. If possible, log the error to the console or record it in a log.</span></span>
- <span data-ttu-id="afe6c-221">Certifique-se de que a seção do manifesto [Escopos](https://docs.microsoft.com/javascript/office/manifest/scopes?view=office-js)  do seu suplemento especifica todas as permissões necessárias.</span><span class="sxs-lookup"><span data-stu-id="afe6c-221">Be sure your add-in manifest [Scopes](https://docs.microsoft.com/javascript/office/manifest/scopes?view=office-js)  section specifies all needed permissions.</span></span> <span data-ttu-id="afe6c-222">Certifique-se também de que o registro do serviço Web do suplemento especifica as mesmas permissões.</span><span class="sxs-lookup"><span data-stu-id="afe6c-222">And be sure your registration of the add-in's web service specifies the same permissions.</span></span> <span data-ttu-id="afe6c-223">Também verifique os erros de ortografia.</span><span class="sxs-lookup"><span data-stu-id="afe6c-223">Check for spelling mistakes too.</span></span> <span data-ttu-id="afe6c-224">Para obter mais informações, consulte [Registrar o suplemento com o ponto de extremidade v2.0 do Azure AD](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) ou [Registrar o suplemento com o ponto de extremidade v2.0 do Azure AD](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), e [Configurar o suplemento](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) ou [Configurar o suplemento](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span><span class="sxs-lookup"><span data-stu-id="afe6c-224">For more information, see [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-aspnet.md#register-the-add-in-with-azure-ad-v20-endpoint) (ASP.NET) or [Register the add-in with Azure AD v2.0 endpoint](create-sso-office-add-ins-nodejs.md#register-the-add-in-with-azure-ad-v20-endpoint) (Node JS), and [Configure the add-in](create-sso-office-add-ins-aspnet.md#configure-the-add-in) (ASP.NET) or [Configure the add-in](create-sso-office-add-ins-nodejs.md#configure-the-add-in) (Node JS).</span></span>

### <a name="expired-or-invalid-token-errors-when-calling-microsoft-graph"></a><span data-ttu-id="afe6c-225">Erros de token expirados ou inválidos ao chamar o Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="afe6c-225">Expired or invalid token errors when calling Microsoft Graph</span></span>

<span data-ttu-id="afe6c-226">Sempre que for necessário, algumas bibliotecas de autenticação e autorização, incluindo o MSAL, evitam erros de token expirados usando um token de atualização em cache.</span><span class="sxs-lookup"><span data-stu-id="afe6c-226">Some authentication and authorization libraries, including MSAL, prevent expired token errors by using a cached refresh token whenever necessary.</span></span> <span data-ttu-id="afe6c-227">Você também pode codificar seu próprio sistema de cache de token.</span><span class="sxs-lookup"><span data-stu-id="afe6c-227">You can also code your own token caching system.</span></span> <span data-ttu-id="afe6c-228">Para ver um exemplo disso, consulte [Suplemento do Office NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), especialmente o arquivo [auth.ts](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/src/auth.ts).</span><span class="sxs-lookup"><span data-stu-id="afe6c-228">For a sample that does this, see [Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO), especially the file [auth.ts](https://github.com/OfficeDev/Office-Add-in-NodeJS-SSO/blob/master/Completed/src/auth.ts).</span></span>

<span data-ttu-id="afe6c-229">Mas, se você recebe um token expirado ou um erro de token inválido, seu código deve dizer ao cliente (no corpo de uma resposta `401 Unauthorized`, por exemplo) para chamar novamente o `getAccessTokenAsync` e repetir a chamada para o ponto de extremidade da API Web do suplemento, que repetirá o fluxo on-behalf-of para obter um novo token para o Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="afe6c-229">But if you get an expired token or invalid token error, your code must tell the client (in the body of a `401 Unauthorized` response, for example) to recall `getAccessTokenAsync` and repeat the call to the endpoint of your add-in's web API, which will repeat the on-behalf-of flow to obtain a new token for Microsoft Graph.</span></span> 

### <a name="invalid-token-error-when-calling-microsoft-graph"></a><span data-ttu-id="afe6c-230">Erro de token inválido ao chamar o Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="afe6c-230">Invalid token error when calling Microsoft Graph</span></span>

<span data-ttu-id="afe6c-p130">Trate esse erro da mesma forma que um erro de token expirado. Consulte a seção anterior.</span><span class="sxs-lookup"><span data-stu-id="afe6c-p130">Handle this error the same as an expired token error. See previous section.</span></span>

### <a name="invalid-audience-error"></a><span data-ttu-id="afe6c-233">Erro de audiência inválida</span><span class="sxs-lookup"><span data-stu-id="afe6c-233">Invalid audience error</span></span>

<span data-ttu-id="afe6c-234">Seu código do lado do servidor deve enviar uma resposta `403 Forbidden` ao cliente que apresente uma mensagem amigável ao usuário e, possivelmente, também registrar o erro no console ou gravá-lo em um registro.</span><span class="sxs-lookup"><span data-stu-id="afe6c-234">Your server-side code should send a `403 Forbidden` response to the client which should present a friendly message to the user and possibly also log the error to the console or record it in a log.</span></span>

<span data-ttu-id="afe6c-235">Para obter mais informações sobre como adicionar suporte para validação de token por vários locatários, consulte a [Exemplo do Azure Multitenant](https://github.com/Azure-Samples/active-directory-dotnet-webapp-webapi-multitenant-openidconnect).</span><span class="sxs-lookup"><span data-stu-id="afe6c-235">For more on adding multitenant support for token validation, see the [Azure Multitenant Sample](https://github.com/Azure-Samples/active-directory-dotnet-webapp-webapi-multitenant-openidconnect).</span></span>
